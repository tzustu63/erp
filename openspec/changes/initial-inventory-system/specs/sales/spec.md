## ADDED Requirements

### Requirement: 銷貨主檔管理
系統 SHALL 提供銷貨主檔（SalesMaster）管理功能，記錄每次銷售的整體資料與發票資訊。

#### Scenario: 建立銷貨單
- **WHEN** 使用者輸入銷貨資訊（銷貨單號、客戶、日期、金額、稅額、發票號碼、發票日期、狀態）
- **THEN** 系統自動產生銷貨主檔 ID 並儲存資料
- **AND** 銷貨單號必須唯一
- **AND** 發票號碼必須唯一

#### Scenario: 自動計算總金額
- **WHEN** 銷貨明細建立完成
- **THEN** 系統自動計算總金額與稅額
- **AND** 更新銷貨主檔金額欄位

### Requirement: 銷貨明細管理
系統 SHALL 提供銷貨明細（SalesDetails）管理功能，記錄每筆銷貨的商品細項。

#### Scenario: 新增銷貨明細
- **WHEN** 使用者為銷貨單新增明細（產品、數量、單價）
- **THEN** 系統自動計算小計（數量 × 單價）
- **AND** 建立與銷貨主檔的關聯

#### Scenario: 銷貨後更新庫存
- **WHEN** 銷貨單完成並設為「已出貨」狀態
- **THEN** 系統自動減少對應產品的庫存量
- **AND** 記錄銷貨日期

#### Scenario: 庫存不足警示
- **WHEN** 銷貨數量超過現有庫存
- **THEN** 系統顯示庫存不足警示
- **AND** 建議修改數量或取消交易

#### Scenario: 查詢銷貨紀錄
- **WHEN** 使用者查詢指定客戶或產品的銷貨紀錄
- **THEN** 系統顯示所有相關銷貨主檔與明細

#### Scenario: 毛利計算
- **WHEN** 銷貨完成
- **THEN** 系統自動計算毛利（銷貨金額 - 進貨成本）
- **AND** 毛利率（毛利 / 銷貨金額）

