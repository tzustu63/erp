# 系統設計文件

## Context

本系統需要支援完整的進銷存流程，從主資料建立到決策分析，涵蓋五個主要業務層：
1. 主資料管理（產品、廠商、客戶）
2. 進貨與銷貨交易
3. 財務對帳與付款
4. 庫存追蹤
5. 決策分析與報表

### 關鍵約束

- 初期以 Excel 為基礎，需預留未來遷移至資料庫的設計空間
- 資料結構需支援 1:N 關聯（主檔與明細）
- 自動化計算需高效能，避免過度複雜的公式
- 分析層需獨立於交易層，避免影響核心流程

## Goals / Non-Goals

### Goals

- 建立統一的資料結構，支援完整業務流程
- 實現庫存自動更新機制，確保資料即時性
- 提供可追溯的歷史價格與交易紀錄
- 支援財務對帳與應收帳款管理
- 提供決策分析工具（比價、成本分析、儀表板）

### Non-Goals

- 不實作多使用者同時編輯功能（初期版本）
- 不包含行動裝置應用程式（未來擴充）
- 不直接整合會計系統（需手動匯入資料）
- 不包含庫存預測與自動補貨功能

## Decisions

### Decision 1: 採用 Excel 作為初期平台

**What**: 使用 Microsoft Excel 建立進銷存系統

**Why**: 
- 快速原型開發，無需額外開發環境
- 熟悉度高，團隊學習曲線平緩
- 內建公式與樞紐分析表功能強大
- 可逐步遷移至關聯式資料庫，保持資料結構一致

**Alternatives considered**:
- Access 資料庫：功能更強但學習曲線較陡
- Web 應用程式：需要開發能力與伺服器環境
- 現成 ERP 系統：成本高且缺乏客製化彈性

### Decision 2: 五層模組化架構

**What**: 將系統分為主資料、交易、財務、庫存、分析五個層級

**Why**:
- 職責分離，各層獨立維護
- 資料關聯清晰，避免循環參照
- 分析層獨立設計，不影響交易效能
- 符合未來微服務架構的設計理念

**Alternatives considered**:
- 單一整合模式：資料管理複雜度高
- 兩層架構（交易+分析）：缺乏財務層獨立性

### Decision 3: 外鍵關聯設計

**What**: 使用 `[ReferencedTable]ID` 作為外鍵欄位名稱

**Why**:
- 命名一致，便於識別與維護
- 符合關聯式資料庫設計慣例
- Excel 中可使用 VLOOKUP 查詢關聯資料

**Alternatives considered**:
- 使用名稱而非代碼：查詢效率低
- 使用代碼而非 ID：資料不穩定

### Decision 4: 庫存自動更新機制

**What**: 透過公式自動計算現存量（期初 + 進貨 - 銷貨）

**Why**:
- 確保庫存資料即時性
- 避免人工計算錯誤
- 符合業務規則要求

**Alternatives considered**:
- 手動更新：容易出錯且效率低
- VBA 巨集：需要技術門檻且不便維護

## Risks / Trade-offs

### Risk 1: Excel 效能限制

**Risk**: 大量資料可能導致計算緩慢

**Mitigation**: 
- 使用樞紐分析表而非陣列公式
- 限制單筆交易明細項目數量
- 未來遷移至資料庫提升效能

### Risk 2: 資料完整性

**Risk**: 使用者可能誤刪或誤改關鍵資料

**Mitigation**:
- 建立資料驗證規則
- 定期備份機制
- 重要欄位保護（工作表保護）
- 文件規範操作流程

### Risk 3: 多使用者衝突

**Risk**: 多人同時編輯可能導致資料不一致

**Mitigation**:
- 初期限制單一使用者編輯
- 使用版本控制追蹤變更
- 未來遷移至資料庫後實作鎖定機制

### Risk 4: 遷移複雜度

**Risk**: 從 Excel 遷移至資料庫可能面臨結構調整

**Mitigation**:
- 保持資料結構符合關聯式資料庫設計
- 使用標準命名規範
- 文件化所有資料結構與計算邏輯

## Migration Plan

### Phase 1: Excel 原型建置（當前階段）

- 建立所有工作表結構
- 設定資料關聯與公式
- 建立儀表板與分析工具
- 測試與驗證

### Phase 2: Excel 優化

- 效能調整
- 使用者介面優化
- 操作手冊建立
- 使用者培訓

### Phase 3: 資料庫遷移準備（未來）

- 評估遷移至 Access 或 SQL Server
- 準備資料遷移腳本
- 建立測試環境
- 平行運作驗證

### Phase 4: 雲端擴充（長期）

- 評估雲端資料庫方案（Azure/AWS）
- 建立 Web API
- 開發行動裝置應用程式

## Open Questions

1. 是否需要支援多幣別交易？
2. 部門支出分類的詳細架構為何？
3. 是否需要支援批次匯入功能？
4. 安全庫存警示的具體規則為何？
5. 報表輸出的標準格式為何？（Excel/PDF/列印）

